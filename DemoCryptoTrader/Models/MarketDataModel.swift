//
//  MarketDataModel.swift
//  DemoCryptoTrader
//
//  Created by Anand Jee Choubey on 2023-12-22.
//

import Foundation

/**
 
 URL: https://api.coingecko.com/api/v3/global
 
 Response:
 {
     "data": {
         "active_cryptocurrencies": 11699,
         "upcoming_icos": 0,
         "ongoing_icos": 49,
         "ended_icos": 3376,
         "markets": 956,
         "total_market_cap": {
             "btc": 39729205.111433774,
             "eth": 753018150.8168625,
             "ltc": 24313932269.351067,
             "bch": 7375487505.111614,
             "bnb": 6457420244.1777935,
             "eos": 2060420831533.039,
             "xrp": 2801594554571.4014,
             "xlm": 13856473068231.158,
             "link": 112966223626.43266,
             "dot": 215278979085.7603,
             "yfi": 205205685.5881074,
             "usd": 1736721341389.9243,
             "aed": 6377839934446.578,
             "ars": 1397663613218607.8,
             "aud": 2548435372092.774,
             "bdt": 190572633216656.22,
             "bhd": 654749155868.0247,
             "bmd": 1736721341389.9243,
             "brl": 8452275424276.4795,
             "cad": 2303663602958.6177,
             "chf": 1481596976339.747,
             "clp": 1529165773880417.5,
             "cny": 12390464738012.295,
             "czk": 38704655176840.28,
             "dkk": 11740564508129.416,
             "eur": 1574692187123.6113,
             "gbp": 1363756959883.7556,
             "gel": 4671780408338.883,
             "hkd": 13570262963252.008,
             "huf": 601505461566000.5,
             "idr": 26826013944478096,
             "ils": 6261140943911.877,
             "inr": 144340371265564.7,
             "jpy": 246695188019744.12,
             "krw": 2253186750631138,
             "kwd": 533564214108.5192,
             "lkr": 565214038004826.5,
             "mmk": 3646411182530658.5,
             "mxn": 29459557776612.555,
             "myr": 8044493253318.146,
             "ngn": 1430510911689967.5,
             "nok": 17682984088190.79,
             "nzd": 2752767584792.663,
             "php": 96403661465770.53,
             "pkr": 484453315693419.9,
             "pln": 6825580590027.619,
             "rub": 160495629321867.28,
             "sar": 6514644947950.568,
             "sek": 17368878929665.633,
             "sgd": 2298248505816.164,
             "thb": 59871731523076.234,
             "try": 50741615495976.61,
             "twd": 53992584174924.57,
             "uah": 65094861908780.88,
             "vef": 173897907913.3734,
             "vnd": 42117666539113640,
             "zar": 31966990894556.45,
             "xdr": 1295314508540.921,
             "xag": 70938710395.6688,
             "xau": 840069480.043719,
             "bits": 39729205111433.77,
             "sats": 3972920511143377.5
         },
         "total_volume": {
             "btc": 2566461.605940238,
             "eth": 48644118.78432995,
             "ltc": 1570652457.9008613,
             "bch": 476448130.6350958,
             "bnb": 417142026.46692365,
             "eos": 133100849648.944,
             "xrp": 180979831827.78207,
             "xlm": 895112449987.7216,
             "link": 7297489967.19445,
             "dot": 13906777969.504564,
             "yfi": 13256054.630475227,
             "usd": 112190229590.36026,
             "aed": 412001228685.0113,
             "ars": 90287484768048.81,
             "aud": 164626035666.9918,
             "bdt": 12310776037971.14,
             "bhd": 42296053126.25453,
             "bmd": 112190229590.36026,
             "brl": 546007409370.36505,
             "cad": 148814056898.7559,
             "chf": 95709484863.53651,
             "clp": 98782375252016.5,
             "cny": 800409973989.4674,
             "czk": 2500276841781.792,
             "dkk": 758427155984.2283,
             "eur": 101723329930.49811,
             "gbp": 88097153405.37123,
             "gel": 301791717598.06824,
             "hkd": 876623601705.9392,
             "huf": 38856570841086.984,
             "idr": 1732930085961033.8,
             "ils": 404462606207.68677,
             "inr": 9324224333237.926,
             "jpy": 15936229447507.125,
             "krw": 145553309468148.25,
             "kwd": 34467643285.898415,
             "lkr": 36512186025598.63,
             "mmk": 235554028156047.97,
             "mxn": 1903054031652.2766,
             "myr": 519665143462.54987,
             "ngn": 92409383007622.28,
             "nok": 1142300723447.7239,
             "nzd": 177825664939.21597,
             "php": 6227567229950.842,
             "pkr": 31295134929336.555,
             "pln": 440924767395.2421,
             "rub": 10367835687133.977,
             "sar": 420838677450.3047,
             "sek": 1122009886333.7795,
             "sgd": 148464247762.89316,
             "thb": 3867645974898.0786,
             "try": 3277850831108.8257,
             "twd": 3487859721879.0312,
             "uah": 4205054275923.285,
             "vef": 11233607688.882792,
             "vnd": 2720753506173738,
             "zar": 2065031368188.8694,
             "xdr": 83675848647.44478,
             "xag": 4582560262.5259075,
             "xau": 54267535.955153085,
             "bits": 2566461605940.2383,
             "sats": 256646160594023.8
         },
         "market_cap_percentage": {
             "btc": 49.277303712009946,
             "eth": 15.937660872317275,
             "usdt": 5.233130269225903,
             "bnb": 2.382602892240511,
             "sol": 2.3185611541325,
             "xrp": 1.9274384164151477,
             "usdc": 1.4237383932407208,
             "ada": 1.2450892212254994,
             "steth": 1.2118105558437993,
             "avax": 0.938543979089565
         },
         "market_cap_change_percentage_24h_usd": 0.32512103469014036,
         "updated_at": 1703253684
     }
 }
 */
struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$\(item.value.formattedWithAbbreviations())"
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$\(item.value.formattedWithAbbreviations())"
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
    
}
 
